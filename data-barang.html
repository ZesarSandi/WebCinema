<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Data Barang | UKM CINEMA</title>
    <link rel="stylesheet" href="css/style_dashboard.css">
</head>
<body>

<div class="topbar">
    <img src="img/Cinema.png" alt="CINEMA" class="logo">
</div>

<div class="container">
    <aside class="sidebar">
        <ul>
            <li><a href="dashboard.html">Dashboard</a></li>
            <li class="active"><a href="data-barang.html" aria-current="page">Data Barang</a></li>
            <li><a href="peminjaman.html">Peminjaman</a></li>
            <li><a href="riwayat.html">Riwayat</a></li>
            <li><a href="laporan.html">Laporan</a></li>
        </ul>
    </aside>

    <main class="content data-barang">
        <div class="main-inner">
        <div class="page-header">
            <h1>Data Barang</h1>
            <div class="page-actions">
                <div class="items-summary" style="margin-right:12px">Total barang: <strong id="total-items-count">0</strong></div>
                <div class="table-toolbar">
                    <input class="table-search" type="search" placeholder="Cari nama, jenis, atau kondisi..." aria-label="Cari">
                    <select class="page-size" aria-label="Baris per halaman">
                        <option value="5">5</option>
                        <option value="10" selected>10</option>
                        <option value="20">20</option>
                        <option value="50">50</option>
                    </select>
                    <button class="btn btn-outline btn-export">Export CSV</button>
                </div>
                <button class="btn btn-primary btn-add" type="button">+ Tambah Barang</button>
                <button class="btn btn-outline btn-seed-items" type="button" style="margin-left:8px">Isi contoh</button>
            </div>
        </div>
        <p id="table-desc" class="sr-only">Tabel inventaris berisi nomor, foto, nama barang, kondisi, jenis, tanggal registrasi, dan aksi.</p>
        <div class="table-controls">
            <div class="table-pagination" aria-hidden="true"></div>
        </div>

        <!-- Modal: Tambah Barang -->
        <div class="modal" id="modal-tambah" aria-hidden="true">
            <div class="modal-overlay" data-close></div>
            <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="modal-title" style="max-width:900px">
                <header class="modal-header">
                    <h3 id="modal-title">Tambah Barang</h3>
                    <button class="modal-close" aria-label="Tutup">√ó</button>
                </header>

                <!-- Single integrated form with QR preview -->
                <div class="modal-body" style="display:grid;grid-template-columns:1fr 320px;gap:24px;align-items:start">
                
                    <!-- Form section (left) -->
                    <form id="form-tambah" class="modal-form">
                        <label>
                            Foto (drag & drop atau pilih file)
                            <div class="dropzone" id="dropzone">
                                <input type="file" accept="image/*" name="foto_file" id="foto_file" hidden>
                                <div class="dropzone-inner">Tarik gambar di sini atau <button type="button" class="btn btn-outline btn-file">Pilih File</button></div>
                            </div>
                            <div class="preview" id="foto_preview" aria-hidden="true"></div>
                            <input type="url" name="foto_url" placeholder="(opsional) URL gambar" class="mt-8">
                        </label>

                        <label>
                            Nama Barang
                            <input type="text" name="nama" placeholder="Nama barang" required>
                        </label> 

                        <label>
                            Kondisi
                            <select name="kondisi" required>
                                <option value="baik">Baik</option>
                                <option value="rusak">Rusak</option>
                                <option value="perbaikan">Perbaikan</option>
                            </select>
                        </label>

                        <label>
                            Jenis
                            <input type="text" name="jenis" placeholder="Jenis barang" required>
                        </label>

                        <label>
                            Tanggal Regis
                            <input type="date" name="tanggal" required>
                        </label>

                        <!-- Hidden input to store QR code -->
                        <input type="hidden" id="qr-code-input" name="qr_code" value="">

                        <div class="modal-actions">
                            <button type="button" class="btn btn-outline" data-close>Batalkan</button>
                            <button type="submit" class="btn btn-primary">Simpan</button>
                        </div>

                        <p class="modal-fallback">Jika tombol tidak bekerja, gunakan halaman <a href="tambah-barang.html">Tambah Barang</a>.</p>
                    </form>

                    <!-- QR Preview section (right) -->
                    <div class="qr-preview-section" style="display:flex;flex-direction:column;gap:16px;padding:16px;background:#f5f7fa;border-radius:8px;border:2px solid #e0e0e0;min-height:300px">
                        <div style="text-align:center">
                            <h4 style="margin:0 0 12px 0;color:#1a237e;font-size:14px">üì± QR Code</h4>
                            
                            <!-- Loading state -->
                            <div id="qr-loading" style="text-align:center;display:none">
                                <div style="font-size:28px;animation:spin 2s linear infinite">‚è≥</div>
                                <p style="margin:8px 0;color:#666;font-size:12px">Generate...</p>
                            </div>

                            <!-- QR Result state -->
                            <div id="qr-result" style="display:none">
                                <img id="qr-image" src="" alt="QR Code" style="max-width:100%;border-radius:8px;border:2px solid #1a237e;background:white;padding:8px;box-sizing:border-box">
                                <div style="margin-top:8px;font-weight:600;font-family:monospace;font-size:12px;color:#1a237e;word-break:break-all" id="qr-code-display"></div>
                            </div>

                            <!-- Empty state -->
                            <div id="qr-empty" style="padding:30px 12px;color:#999">
                                <div style="font-size:32px;margin-bottom:8px">üì∑</div>
                                <p style="margin:0;font-size:12px">Isi nama barang untuk<br>auto-generate QR</p>
                            </div>
                        </div>

                        <!-- Action buttons -->
                        <div id="qr-actions" style="display:none;display:flex;flex-direction:column;gap:8px">
                            <button type="button" class="btn btn-primary" id="qr-download-btn" style="font-size:12px;padding:8px 12px">üíæ Download</button>
                            <button type="button" class="btn btn-outline" id="qr-print-btn" style="font-size:12px;padding:8px 12px">üñ®Ô∏è Cetak</button>
                            <button type="button" class="btn btn-outline" id="qr-copy-code-btn" style="font-size:12px;padding:8px 12px">üìã Copy</button>
                        </div>
                    </div>

                </div>

                <style>
                    @keyframes spin {
                        from { transform: rotate(0deg); }
                        to { transform: rotate(360deg); }
                    }
                    @media (max-width: 768px) {
                        .modal-panel {
                            max-width: 95% !important;
                        }
                        .modal-body {
                            grid-template-columns: 1fr !important;
                        }
                        .qr-preview-section {
                            display: none;
                        }
                    }
                </style>
            </div>
        </div>

        <!-- Modal: Cetak Label -->
        <div class="modal" id="modal-label" aria-hidden="true">
            <div class="modal-overlay" data-close></div>
            <div class="modal-panel" role="dialog" aria-modal="true">
                <header class="modal-header">
                    <h3 id="modal-label-title">Label QR</h3>
                    <button class="modal-close" aria-label="Tutup">√ó</button>
                </header>
                <div class="modal-body" id="modal-label-body">
                    <div style="text-align:center">
                        <img id="label-qr-img" src="" alt="QR" style="max-width:240px;border-radius:6px">
                        <div style="margin-top:8px;font-weight:700" id="label-code-text"></div>
                        <p class="mt-6">Scan dengan kamera HP untuk langsung membuka form peminjaman.</p>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-outline" data-close>Close</button>
                    <button class="btn btn-primary" id="label-print">Cetak</button>
                </div>
            </div>
        </div>

        <div class="table-wrap">
            <caption class="sr-only">Daftar inventaris barang UKM CINEMA</caption>
            <table class="data-table" aria-describedby="table-desc">
                <thead>
                    <tr>
                        <th class="col-no">No</th>
                        <th class="col-foto">Foto</th>
                        <th class="col-nama">Nama Barang</th>
                        <th class="col-kondisi">Kondisi</th>
                        <th class="col-jenis">Jenis</th>
                        <th class="col-tgl">Tanggal Regis</th>
                        <th class="col-kode">Kode</th>
                        <th class="col-aksi">Aksi</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        </div>
    </main>
</div>

<!-- QRCode library from npm (local bundle via browserify) -->
<script src="assets/js/qrcode-bundle.js"></script>
<script src="assets/js/config.js"></script>
<script src="assets/js/app.js"></script>
<script src="assets/js/qr-auto-generator.js"></script>
<script src="assets/js/data-barang.js"></script>
<script src="assets/js/google-integration.js"></script>
</body>
</html>